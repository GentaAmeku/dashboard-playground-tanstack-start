# Setup Database（開発環境専用）

開発環境の SQLite データベースをセットアップします。  
**`pnpm db:push` と `pnpm db:seed` のみ**を使用し、マイグレーションファイルの生成や本番環境向けの手順は扱いません。

## 実行前の確認チェックリスト

- [ ] 開発サーバーが停止していることを確認（`local.db` がロックされないように）
- [ ] `package.json` に必要なスクリプトが定義されていることを確認
  - [ ] `db:push` が存在する
  - [ ] `db:seed` が存在する
- [ ] `drizzle.config.ts` が正しく設定されていることを確認
- [ ] `lib/db/schema.ts` が最新の状態であることを確認
- [ ] `scripts/seed.ts` が存在し、正常に動作することを確認

## 実行手順チェックリスト

### ステップ1: 既存データベースのクリーンアップ（オプション）

既存のデータベースがある場合、クリーンな状態から始めるために削除できます：

- [ ] `local.db` ファイルが存在するか確認
- [ ] 既存のデータベースを削除する場合は実行
  ```bash
  rm -f local.db local.db-shm local.db-wal
  ```
- [ ] SQLiteの関連ファイル（`local.db-shm`, `local.db-wal`）も削除
- [ ] ファイルが正常に削除されたことを確認

**注意**: 初回セットアップの場合は、このステップは不要です。

### ステップ2: スキーマの反映（`db:push`）

- [ ] スキーマから直接データベースを更新
  ```bash
  pnpm db:push
  ```
- [ ] `local.db` ファイルが新規作成または更新されたことを確認
- [ ] エラーが発生していないことを確認

### ステップ3: シードデータの投入

- [ ] シードデータを投入
  ```bash
  pnpm db:seed
  ```
- [ ] エラーが発生していないことを確認（エラーメッセージを確認）
- [ ] コンソールに以下のいずれかが表示されたことを確認
  - "✅ Successfully added seed data" （データが投入された場合）
  - "ℹ️ The database already has data. Skipping seeding." （既にデータがある場合）
- [ ] エラーが発生した場合は、以下を確認
  - データベースファイル（`local.db`）が存在するか
  - データベースファイルがロックされていないか（開発サーバーが停止しているか）
  - `scripts/seed.ts` の構文エラーがないか

## 実行後の確認チェックリスト

- [ ] `local.db` ファイルが存在することを確認
- [ ] データベースにシードデータが投入されていることを確認
  - [ ] タスクが8件作成されていることを確認
  - [ ] 各タスクのステータスと優先度が正しく設定されていることを確認
- [ ] 開発サーバーを起動して、アプリケーションが正常に動作することを確認

## エラー時の対処

### スキーマ反映（`db:push`）エラー
- `lib/db/schema.ts` の構文エラーを確認
- `drizzle.config.ts` の設定を確認
- データベースファイル（`local.db`）の権限を確認
- 既存のデータベースファイルがロックされていないか確認（開発サーバーが停止しているか）

### シードデータ投入エラー
- `scripts/seed.ts` の構文エラーを確認
- `lib/db/seed.ts` の構文エラーを確認
- データベース接続が正常か確認
- スキーマとシードデータの整合性を確認
- データベースファイル（`local.db`）が存在するか確認
- 開発サーバーが停止しているか確認（データベースがロックされていないか）

## 一括実行コマンド

すべてのチェックリストを確認した後、以下のコマンドで一括実行できます：

### 初回セットアップ（開発環境・既存データベースがない場合）

```bash
pnpm db:push && pnpm db:seed
```

### 既存データベースをリセットしてからセットアップ（開発環境）

```bash
rm -f local.db local.db-shm local.db-wal && pnpm db:push && pnpm db:seed
```
